#!/bin/bash

docker stop test
docker rm -v test

if [ "$PWD" != "$HOME" ] && [ "" == "${LIFERAY_HOME_MOUNT}" ]; then
	if [ -f portal-ext.properties ]; then
		LIFERAY_HOME_MOUNT="-v ${PWD}:/build"
	elif [ -d drivers ]; then
		LIFERAY_HOME_MOUNT="-v ${PWD}:/build"
	elif [ -d patches ]; then
		LIFERAY_HOME_MOUNT="-v ${PWD}:/build"
	elif [ -d bundles ]; then
		LIFERAY_HOME_MOUNT="-v ${PWD}/bundles:/build"
	fi
fi

if [ ! -d ${HOME}/.liferay/release ]; then
	mkdir -p ${HOME}/.liferay/release
fi

LIFERAY_RELEASE_MOUNT="-v ${HOME}/.liferay/release:/release"

if [[ $1 == portal-* ]] || [[ $1 == *-6210 ]] || [[ $1 == *-6210.zip ]]; then
	docker run --name test ${LIFERAY_HOME_MOUNT} ${LIFERAY_RELEASE_MOUNT} -e LIFERAY_PASSWORD=${LIFERAY_PASSWORD} mcd-nightly-jdk7 $1
else
	docker run --name test ${LIFERAY_HOME_MOUNT} ${LIFERAY_RELEASE_MOUNT} -e LIFERAY_PASSWORD=${LIFERAY_PASSWORD} mcd-nightly-jdk8 $1
fi
